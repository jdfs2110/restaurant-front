<app-header></app-header>
<main>

  @defer {
  <div class="card md:hidden">
    <p-tabView [scrollable]="true" (onChange)="findMesa($event)">
      @for (mesa of mesas; track mesa.id) {
      <p-tabPanel [header]="'Mesa ' + mesa.id.toString()">

        <p-card [header]="'Mesa ' + mesa.id"
          [subheader]="'Capacidad máxima: ' + formatMaxCapacity(mesa.capacidad_maxima)">

          <p>Estado: {{ mesaActual.estado }}</p>

          <ng-template pTemplate="footer">
            @if (mesaActual.estado_numero === 1) {
            <div class="flex flex-row gap-2 w-full">
              <div class="flex-1">
                <p-button styleClass="w-full" label="Servir" (onClick)="servirPedido(mesaActual.id)" [loading]="loading"
                  iconPos="right" />
              </div>
              <div class="flex-1">
                <p-button styleClass="w-full" label="Ver pedido" (onClick)="verPedido(mesaActual.id)" /> <!--TODO-->
              </div>
            </div>
            } @else {
            <p-button label="Nuevo pedido" styleClass="w-full" (onClick)="newPedido(mesa.id)" />
            }
          </ng-template>

        </p-card>

      </p-tabPanel>
      }
    </p-tabView>
  </div>
  }

  @placeholder {
  <div class="flex justify-content-center align-items-center min-h-screen gap-4">
    <p>Cargando...</p>
    <p-progressSpinner ariaLabel="loading" styleClass="w-4rem h-4rem" strokeWidth="5" animationDuration=".5s" />
  </div>
  }

  <div class="card flex justify-content-center">
    <p-dialog [(visible)]="newPedidoVisible" [maximizable]="true" [modal]="true" header="Nuevo pedido"
      [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [draggable]="false">
      <form [formGroup]="newPedidoForm" (submit)="onSubmit()">

        <div class="field">
          <label for="numero_comensales">Número de comensales</label>
          <input type="number" pInputText formControlName="numero_comensales" class="w-full px-2">
          @if (submitted && newPedidoForm.controls.numero_comensales.invalid) {
          <error-p>{{getNumeroComensalesError()}}</error-p>
          }
        </div>

        <div class="field">
          <label for="id_mesa">ID de Mesa</label>
          <input type="number" pInputText readonly formControlName="id_mesa" class="w-full px-2">
        </div>

        <div class="field">
          <label for="id_usuario">ID de Empleado</label>
          <input type="number" pInputText readonly formControlName="id_usuario" class="w-full px-2">
        </div>

        <p-button label="Crear" styleClass="w-full" type="submit" [loading]="loading" iconPos="right"></p-button>
      </form>
    </p-dialog>
  </div>

  <div class="card flex justify-content-center">
    <p-dialog [(visible)]="viewPedidoVisible" [maximizable]="true" [modal]="true"
      [header]="'Pedido actual de la mesa ' + mesaActual.id" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
      [draggable]="false">
      <p>TODO: ver como mostrar los datos</p>
      <p>Mostrar pedido, mostrar lineas, añadir línea (cocina, barra...)</p>
    </p-dialog>
  </div>
</main>